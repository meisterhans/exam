Для авторизации пользователя использовался пакет passport <br>
Для работы сессий - express-session
Для реализации логики использовались методы serializeUser и deserializeUser и стратегия passport-local
После ввода данных пользователя при помощи passport проверяем валидность этих данных
Если данные корректны идет запись сессии пользователя.
Если введенные данные не верны или пользователь заходит на страницу профиля или страницу RAW не авторизированным, происходит перенаправление на страницу логина при помощи middleware
Так же, если пользователь заходит на страницу профиля или страницу RAW не авторизированным происходит запись сессии returnTo перед перенаправлением с данными о странице с которой произошло это перенаправление, после ввода корректных данных юзера и если существует сессия returnTo, идет перенаправление на страницу которую пользователь и хотел видеть
